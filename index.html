<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Ummah - Complete Islamic Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0d7e83;
            --secondary-color: #0aa5aa;
            --dark-bg: #1a1a2e;
            --card-bg: #16213e;
            --text-light: #e6e6e6;
            --accent-color: #ff9a00;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-light);
            padding-bottom: 80px;
            line-height: 1.6;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .current-date {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .hijri-date {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .prayer-times-container {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .prayer-time-card {
            text-align: center;
            padding: 10px 5px;
            border-radius: 10px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .prayer-time-card.active {
            background-color: var(--primary-color);
            transform: scale(1.05);
        }
        
        .prayer-name {
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .prayer-time {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .next-prayer-banner {
            background: linear-gradient(90deg, var(--accent-color), #ff6a00);
            border-radius: 10px;
            padding: 12px 15px;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 8px rgba(255, 154, 0, 0.3);
        }
        
        .feature-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
            cursor: pointer;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        
        .feature-title {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .feature-description {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .qibla-compass {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
            margin: 20px auto;
            position: relative;
            background-color: var(--card-bg);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        
        .qibla-arrow {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%) rotate(0deg);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 90px solid var(--accent-color);
            transform-origin: 50% 100%;
            transition: transform 1s cubic-bezier(0.2, 0.8, 0.5, 1);
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }
        
        .nav-item {
            text-align: center;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.7rem;
            opacity: 0.7;
            transition: all 0.3s;
            flex: 1;
        }
        
        .nav-item.active {
            opacity: 1;
            color: var(--secondary-color);
        }
        
        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 3px;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .quran-verse {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .arabic-text {
            font-size: 1.5rem;
            line-height: 2;
            font-family: 'Amiri', serif;
            text-align: right;
            margin-bottom: 15px;
        }
        
        .translation-text {
            font-size: 0.95rem;
            opacity: 0.9;
            line-height: 1.6;
        }
        
        .surah-item {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .surah-item:hover {
            background-color: rgba(255,255,255,0.05);
        }
        
        .surah-item:last-child {
            border-bottom: none;
        }
        
        .surah-name {
            font-weight: bold;
        }
        
        .surah-details {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .chat-container {
            height: 60vh;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background-color: var(--card-bg);
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .chat-message {
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 10px;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .user-message {
            background-color: var(--primary-color);
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background-color: rgba(255,255,255,0.1);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            background-color: var(--card-bg);
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            color: var(--text-light);
        }
        
        .chat-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .send-button:hover {
            transform: scale(1.05);
        }
        
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots:after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .search-box {
            background-color: var(--card-bg);
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            color: var(--text-light);
            width: 100%;
            margin-bottom: 15px;
        }
        
        .search-box:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        
        .hadith-item {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .hadith-arabic {
            font-family: 'Amiri', serif;
            font-size: 1.2rem;
            text-align: right;
            margin-bottom: 10px;
        }
        
        .dhikr-counter {
            text-align: center;
            padding: 20px;
        }
        
        .counter-display {
            font-size: 4rem;
            font-weight: bold;
            color: var(--secondary-color);
            margin: 15px 0;
            transition: color 0.3s;
        }
        
        .counter-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .counter-btn:hover {
            transform: scale(1.05);
        }
        
        .islamic-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 10px 5px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .calendar-day:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .calendar-day.active {
            background-color: var(--primary-color);
        }
        
        .calendar-day.hijri {
            border: 1px solid var(--primary-color);
        }
        
        .calendar-header {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            opacity: 0.8;
        }
        
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-bg);
            color: var(--text-light);
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1001;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 20px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            transform: translateY(-2px);
        }
        
        .btn-outline-primary {
            border-color: var(--primary-color);
            color: var(--primary-color);
            border-radius: 25px;
            padding: 8px 16px;
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .form-select {
            background-color: var(--card-bg);
            border-color: rgba(255,255,255,0.1);
            color: var(--text-light);
            border-radius: 10px;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23e6e6e6' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
        }
        
        .form-select:focus {
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        
        .spinner-border {
            color: var(--primary-color);
        }
        
        /* Responsive adjustments */
        @media (max-width: 576px) {
            .prayer-time-card {
                padding: 8px 3px;
            }
            
            .prayer-time {
                font-size: 1rem;
            }
            
            .arabic-text {
                font-size: 1.3rem;
            }
            
            .qibla-compass {
                width: 180px;
                height: 180px;
            }
            
            .chat-container {
                height: 50vh;
            }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
        
        /* Enhanced Chatbot Styles */
        .quick-questions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .quick-question {
            background-color: var(--primary-color);
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-question:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .chat-suggestion {
            text-align: center;
            margin: 10px 0;
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .hadith-reference {
            font-size: 0.8rem;
            margin-top: 5px;
            opacity: 0.7;
        }
        
        /* Full Surah Page Styles */
        .surah-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .surah-content {
            max-height: 70vh;
            overflow-y: auto;
            padding: 15px;
        }
        
        .verse-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .verse-number {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-size: 0.8rem;
        }
        
        /* Hadith Tab Styles */
        .hadith-collection-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .collection-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--primary-color);
            border-radius: 20px;
            padding: 8px 15px;
            color: var(--text-light);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .collection-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .hadith-search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .hadith-search-input {
            flex: 1;
            background-color: var(--card-bg);
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            color: var(--text-light);
        }
        
        .hadith-search-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        
        .hadith-book-item {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .hadith-book-item:hover {
            background-color: rgba(255,255,255,0.05);
        }
        
        .hadith-book-item:last-child {
            border-bottom: none;
        }
        
        .hadith-book-name {
            font-weight: bold;
        }
        
        .hadith-book-details {
            font-size: 0.8rem;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="mb-0">Global Ummah</h3>
                    <div class="current-date" id="current-date">Loading...</div>
                </div>
                <div class="text-end">
                    <div class="hijri-date" id="hijri-date">Loading...</div>
                    <div id="location-display">Locating...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-3">
        <!-- Home Tab -->
        <div class="tab-content active" id="home-tab">
            <div class="next-prayer-banner">
                <div>
                    <div>Next Prayer</div>
                    <div class="fw-bold" id="next-prayer-name">Loading...</div>
                </div>
                <div class="text-end">
                    <div>Starts in</div>
                    <div class="fw-bold" id="next-prayer-time">--:--</div>
                </div>
            </div>
            
            <div class="prayer-times-container">
                <div class="row text-center" id="home-prayer-times">
                    <div class="col prayer-time-card" id="fajr-card">
                        <div class="prayer-name">Fajr</div>
                        <div class="prayer-time" id="fajr-time">--:--</div>
                    </div>
                    <div class="col prayer-time-card" id="dhuhr-card">
                        <div class="prayer-name">Dhuhr</div>
                        <div class="prayer-time" id="dhuhr-time">--:--</div>
                    </div>
                    <div class="col prayer-time-card" id="asr-card">
                        <div class="prayer-name">Asr</div>
                        <div class="prayer-time" id="asr-time">--:--</div>
                    </div>
                    <div class="col prayer-time-card" id="maghrib-card">
                        <div class="prayer-name">Maghrib</div>
                        <div class="prayer-time" id="maghrib-time">--:--</div>
                    </div>
                    <div class="col prayer-time-card" id="isha-card">
                        <div class="prayer-name">Isha</div>
                        <div class="prayer-time" id="isha-time">--:--</div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-6 mb-3">
                    <div class="feature-card" onclick="switchTab('qibla-tab')">
                        <div class="feature-icon">
                            <i class="fas fa-compass"></i>
                        </div>
                        <div class="feature-title">Qibla Direction</div>
                        <div class="feature-description">Find direction to Kaaba</div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="feature-card" onclick="switchTab('quran-tab')">
                        <div class="feature-icon">
                            <i class="fas fa-book-quran"></i>
                        </div>
                        <div class="feature-title">Quran</div>
                        <div class="feature-description">Read and listen to Quran</div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="feature-card" onclick="switchTab('tasbih-tab')">
                        <div class="feature-icon">
                            <i class="fas fa-hands"></i>
                        </div>
                        <div class="feature-title">Tasbih Counter</div>
                        <div class="feature-description">Digital dhikr counter</div>
                    </div>
                </div>
                <div class="col-6 mb-3">
                    <div class="feature-card" onclick="switchTab('hadith-tab')">
                        <div class="feature-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="feature-title">Hadith Collection</div>
                        <div class="feature-description">Sahih Muslim & other hadiths</div>
                    </div>
                </div>
            </div>
            
            <div class="quran-verse">
                <h5 class="text-center mb-3">Verse of the Day</h5>
                <div class="arabic-text" id="daily-verse-arabic">Loading...</div>
                <div class="translation-text" id="daily-verse-translation">Loading translation...</div>
                <div class="text-center mt-3">
                    <small id="daily-verse-reference">Surah, Verse</small>
                </div>
            </div>
        </div>
        
        <!-- Quran Tab -->
        <div class="tab-content" id="quran-tab">
            <h5 class="section-title">The Holy Quran</h5>
            
            <input type="text" class="search-box" placeholder="Search Quran..." id="quran-search">
            
            <div class="quran-verse mb-3">
                <div class="arabic-text" id="quran-display-arabic">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</div>
                <div class="translation-text" id="quran-display-translation">In the name of Allah, the Entirely Merciful, the Especially Merciful.</div>
                <div class="text-center mt-3">
                    <small id="quran-display-reference">Surah Al-Fatihah, Verse 1</small>
                </div>
            </div>
            
            <div class="d-flex justify-content-between mb-3">
                <button class="btn btn-outline-primary" onclick="previousVerse()">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <button class="btn btn-outline-primary" onclick="randomVerse()">
                    <i class="fas fa-random"></i> Random
                </button>
                <button class="btn btn-outline-primary" onclick="nextVerse()">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <h6 class="mt-4 mb-3">Surahs</h6>
            <div id="surah-list">
                <!-- Surah list will be populated here -->
            </div>
        </div>
        
        <!-- Prayer & Qibla Tab -->
        <div class="tab-content" id="qibla-tab">
            <h5 class="section-title">Prayer & Qibla</h5>
            
            <div class="text-center">
                <div class="qibla-compass">
                    <div class="qibla-arrow" id="qibla-arrow"></div>
                    <div class="position-absolute top-0 start-50 translate-middle-x mt-1">N</div>
                    <div class="position-absolute bottom-0 start-50 translate-middle-x mb-1">S</div>
                    <div class="position-absolute top-50 start-0 translate-middle-y ms-1">W</div>
                    <div class="position-absolute top-50 end-0 translate-middle-y me-1">E</div>
                </div>
                <p class="mt-3">Qibla Direction: <span id="qibla-degrees" class="fw-bold">--</span>°</p>
                <button class="btn btn-primary" onclick="recalibrateQibla()">
                    <i class="fas fa-sync-alt"></i> Recalibrate
                </button>
            </div>
            
            <div class="mt-4">
                <h6>Prayer Times Today</h6>
                <div class="prayer-times-container">
                    <div class="row">
                        <div class="col-6 mb-2">Fajr</div>
                        <div class="col-6 mb-2 text-end" id="prayer-fajr">--:--</div>
                        <div class="col-6 mb-2">Sunrise</div>
                        <div class="col-6 mb-2 text-end" id="prayer-sunrise">--:--</div>
                        <div class="col-6 mb-2">Dhuhr</div>
                        <div class="col-6 mb-2 text-end" id="prayer-dhuhr">--:--</div>
                        <div class="col-6 mb-2">Asr</div>
                        <div class="col-6 mb-2 text-end" id="prayer-asr">--:--</div>
                        <div class="col-6 mb-2">Maghrib</div>
                        <div class="col-6 mb-2 text-end" id="prayer-maghrib">--:--</div>
                        <div class="col-6 mb-2">Isha</div>
                        <div class="col-6 mb-2 text-end" id="prayer-isha">--:--</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tasbih Counter Tab -->
        <div class="tab-content" id="tasbih-tab">
            <h5 class="section-title">Digital Tasbih</h5>
            
            <div class="feature-card">
                <div class="dhikr-counter">
                    <div class="counter-display" id="dhikr-counter">0</div>
                    <div class="mb-3">
                        <select class="form-select form-select-sm" id="dhikr-type" onchange="resetDhikr()">
                            <option value="33" data-name="SubhanAllah">SubhanAllah (33x)</option>
                            <option value="33" data-name="Alhamdulillah">Alhamdulillah (33x)</option>
                            <option value="33" data-name="Allahu Akbar">Allahu Akbar (33x)</option>
                            <option value="100" data-name="La ilaha illa Allah">La ilaha illa Allah (100x)</option>
                        </select>
                    </div>
                    <button class="counter-btn" onclick="incrementDhikr()">
                        <i class="fas fa-plus"></i>
                    </button>
                    <div class="mt-3">
                        <button class="btn btn-outline-secondary" onclick="resetDhikr()">Reset</button>
                    </div>
                </div>
            </div>
            
            <!-- Islamic Calendar -->
            <div class="feature-card mt-4">
                <h6 class="text-center">Islamic Calendar</h6>
                <div class="text-center mb-3" id="hijri-month">Loading...</div>
                <div class="islamic-calendar" id="islamic-calendar">
                    <!-- Calendar will be populated here -->
                </div>
            </div>
            
            <!-- 99 Names -->
            <div class="feature-card mt-4">
                <h6 class="text-center">99 Names of Allah</h6>
                <div class="text-center my-3">
                    <div class="arabic-text" id="allah-name-arabic">الرَّحْمَنُ</div>
                    <div class="fw-bold mt-2" id="allah-name-english">Ar-Rahman</div>
                    <div class="text-muted" id="allah-name-meaning">The Beneficent</div>
                </div>
                <button class="btn btn-primary w-100" onclick="nextAllahName()">Next Name</button>
            </div>
        </div>
        
        <!-- Hadith Tab -->
        <div class="tab-content" id="hadith-tab">
            <h5 class="section-title">Hadith Collection</h5>
            
            <div class="hadith-collection-selector">
                <button class="collection-btn active" data-collection="bukhari">Sahih Bukhari</button>
                <button class="collection-btn" data-collection="muslim">Sahih Muslim</button>
                <button class="collection-btn" data-collection="abudawud">Sunan Abi Dawud</button>
                <button class="collection-btn" data-collection="tirmidhi">Jami` at-Tirmidhi</button>
                <button class="collection-btn" data-collection="nasai">Sunan an-Nasa'i</button>
                <button class="collection-btn" data-collection="ibnmajah">Sunan Ibn Majah</button>
            </div>
            
            <div class="hadith-search-container">
                <input type="text" class="hadith-search-input" id="hadith-search" placeholder="Search hadiths...">
                <button class="btn btn-primary" onclick="searchHadiths()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <div id="hadith-books-list">
                <!-- Hadith books will be populated here -->
            </div>
            
            <div id="hadith-results" class="mt-4">
                <!-- Hadith search results will be displayed here -->
            </div>
        </div>
        
        <!-- Chatbot Tab -->
        <div class="tab-content" id="chatbot-tab">
            <h5 class="section-title">Islamic Assistant</h5>
            
            <div class="quick-questions">
                <button class="quick-question" onclick="askQuickQuestion('What are the five pillars of Islam?')">Five Pillars</button>
                <button class="quick-question" onclick="askQuickQuestion('How to perform wudu?')">Wudu Steps</button>
                <button class="quick-question" onclick="askQuickQuestion('Tell me about Ramadan')">Ramadan</button>
                <button class="quick-question" onclick="askQuickQuestion('What is Zakat?')">Zakat</button>
                <button class="quick-question" onclick="askQuickQuestion('Tell me a hadith about kindness')">Kindness Hadith</button>
            </div>
            
            <div class="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <div class="chat-message bot-message">
                        <p>As-salamu alaykum! I'm your Islamic assistant. How can I help you today? You can ask me about Quran, Hadith, Islamic practices, or any other Islamic topics.</p>
                    </div>
                    <div class="chat-suggestion">Try asking: "What are the five pillars of Islam?" or "How to perform wudu?"</div>
                </div>
                
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Ask your question..." onkeypress="handleChatInput(event)">
                    <button class="send-button" onclick="sendChatMessage()" id="send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active" data-tab="home-tab">
            <div class="nav-icon"><i class="fas fa-home"></i></div>
            <div>Home</div>
        </a>
        <a href="#" class="nav-item" data-tab="quran-tab">
            <div class="nav-icon"><i class="fas fa-book-quran"></i></div>
            <div>Quran</div>
        </a>
        <a href="#" class="nav-item" data-tab="qibla-tab">
            <div class="nav-icon"><i class="fas fa-compass"></i></div>
            <div>Prayer</div>
        </a>
        <a href="#" class="nav-item" data-tab="hadith-tab">
            <div class="nav-icon"><i class="fas fa-book"></i></div>
            <div>Hadith</div>
        </a>
        <a href="#" class="nav-item" data-tab="chatbot-tab">
            <div class="nav-icon"><i class="fas fa-robot"></i></div>
            <div>Chat</div>
        </a>
    </div>

    <!-- Full Surah Modal -->
    <div class="modal fade" id="surahModal" tabindex="-1" aria-labelledby="surahModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content" style="background-color: var(--dark-bg); color: var(--text-light);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <h5 class="modal-title" id="surahModalLabel">Surah Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="surah-header" id="surah-modal-header">
                        <h3 id="surah-modal-name">Surah Name</h3>
                        <p id="surah-modal-details">Details</p>
                    </div>
                    <div class="surah-content" id="surah-modal-content">
                        <!-- Surah verses will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255,255,255,0.1);">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hadith Details Modal -->
    <div class="modal fade" id="hadithModal" tabindex="-1" aria-labelledby="hadithModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="background-color: var(--dark-bg); color: var(--text-light);">
                <div class="modal-header" style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <h5 class="modal-title" id="hadithModalLabel">Hadith Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="hadith-modal-content">
                        <!-- Hadith details will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid rgba(255,255,255,0.1);">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentVerse = 1;
        let currentSurah = 1;
        let dhikrCount = 0;
        let dhikrTarget = 33;
        let allahNamesIndex = 0;
        let prayerTimes = {};
        let prayerNames = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
        let nextPrayerTimer;
        let userLocation = null;
        let qiblaDirection = 0;
        let allSurahs = [];
        let currentHadithCollection = "bukhari";
        const TOTAL_SURAH = 114;

        // API Endpoints
        const QURAN_API = "https://api.alquran.cloud/v1";
        const PRAYER_API = "https://api.aladhan.com/v1";
        const HIJRI_API = "https://api.aladhan.com/v1/gToH";
        const HADITH_API = "https://hadith2.p.rapidapi.com";
        const CHATBOT_API = "https://ai-islamic-chatbot-quran-hadith-fiqh-fatwa-halal-q-a.p.rapidapi.com";
        const RAPIDAPI_KEY = "d634f27a3amshe0b6cab8fc52123p168531jsnc04263e59c73";

        // Enhanced Islamic Knowledge Base
        const ISLAMIC_KNOWLEDGE = {
            greetings: [
                "As-salamu alaykum wa rahmatullahi wa barakatuh! How can I assist you with your Islamic questions today?",
                "Wa alaykum assalam! May peace and blessings be upon you. How can I help you learn about Islam today?",
                "Peace be upon you! I'm here to help with any questions you have about Islam, the Quran, or Islamic practices."
            ],
            
            pillars: {
                question: "What are the five pillars of Islam?",
                answer: "The Five Pillars of Islam are the foundation of Muslim life:\n\n1. **Shahada** (Faith): Declaration of faith in the oneness of God and acceptance of Muhammad as God's prophet.\n\n2. **Salah** (Prayer): Performing the five daily prayers.\n\n3. **Zakat** (Charity): Giving to those in need.\n\n4. **Sawm** (Fasting): Fasting during the month of Ramadan.\n\n5. **Hajj** (Pilgrimage): Pilgrimage to Mecca at least once in a lifetime for those who are able."
            },
            
            wudu: {
                question: "How to perform wudu?",
                answer: "Wudu (ablution) is performed as follows:\n\n1. Make intention in your heart.\n2. Say 'Bismillah' (In the name of Allah).\n3. Wash hands up to the wrists three times.\n4. Rinse mouth three times.\n5. Clean nose by sniffing water three times.\n6. Wash face three times.\n7. Wash arms up to elbows three times (right first).\n8. Wipe head with wet hands once.\n9. Wipe ears with index fingers and thumbs.\n10. Wash feet up to ankles three times (right first).\n\nThis purifies you for prayer."
            },
            
            ramadan: {
                question: "Tell me about Ramadan",
                answer: "Ramadan is the ninth month of the Islamic calendar, observed by Muslims worldwide as a month of fasting, prayer, reflection, and community. Key aspects:\n\n• Fasting from dawn to sunset\n• Increased prayer and Quran recitation\n• Night prayers (Taraweeh)\n• Seeking Laylat al-Qadr (Night of Power)\n• Increased charity and good deeds\n• Breaking fast with dates and water\n• Ends with Eid al-Fitr celebration"
            },
            
            zakat: {
                question: "What is Zakat?",
                answer: "Zakat is the third pillar of Islam - an obligatory charity for Muslims who meet the necessary criteria of wealth. Key points:\n\n• **Purpose**: Purifies wealth and helps those in need\n• **Rate**: Typically 2.5% of savings and wealth above the nisab (minimum amount)\n• **Nisab**: The minimum amount is equivalent to 85 grams of gold or 595 grams of silver\n• **Recipients**: The poor, needy, those in debt, travelers, and others mentioned in Quran 9:60\n• **Timing**: Paid once a year after wealth has been held for one lunar year"
            },
            
            hadiths: [
                {
                    text: "The best among you are those who have the best manners and character.",
                    reference: "Sahih al-Bukhari"
                },
                {
                    text: "A Muslim is one from whose tongue and hand other Muslims are safe.",
                    reference: "Sahih al-Bukhari"
                },
                {
                    text: "The strong is not the one who overcomes the people by his strength, but the strong is the one who controls himself while in anger.",
                    reference: "Sahih al-Bukhari"
                },
                {
                    text: "None of you truly believes until he loves for his brother what he loves for himself.",
                    reference: "Sahih al-Bukhari"
                },
                {
                    text: "The world is the believer's prison and the unbeliever's paradise.",
                    reference: "Sahih Muslim"
                }
            ],
            
            quranFacts: [
                "The Quran was revealed to Prophet Muhammad (PBUH) over 23 years.",
                "It contains 114 chapters (surahs) and 6,236 verses (ayahs).",
                "The longest chapter is Al-Baqarah (The Cow) with 286 verses.",
                "The shortest chapter is Al-Kawthar (Abundance) with only 3 verses.",
                "The Quran has been preserved in its original Arabic text since revelation.",
                "It is divided into 30 approximately equal parts (juz) for monthly reading."
            ]
        };

        // Mock Data for Quran and Allah's Names
        const MOCK_QURAN_DATA = {
            surahs: [
                { number: 1, englishName: "Al-Fatihah", name: "الفاتحة", englishNameTranslation: "The Opener", numberOfAyahs: 7, revelationType: "Meccan" },
                { number: 2, englishName: "Al-Baqarah", name: "البقرة", englishNameTranslation: "The Cow", numberOfAyahs: 286, revelationType: "Medinan" },
                { number: 36, englishName: "Ya-Sin", name: "يس", englishNameTranslation: "Ya Sin", numberOfAyahs: 83, revelationType: "Meccan" },
                { number: 55, englishName: "Ar-Rahman", name: "الرحمن", englishNameTranslation: "The Beneficent", numberOfAyahs: 78, revelationType: "Medinan" },
                { number: 67, englishName: "Al-Mulk", name: "الملك", englishNameTranslation: "The Sovereignty", numberOfAyahs: 30, revelationType: "Meccan" },
                { number: 112, englishName: "Al-Ikhlas", name: "الإخلاص", englishNameTranslation: "The Sincerity", numberOfAyahs: 4, revelationType: "Meccan" },
                { number: 113, englishName: "Al-Falaq", name: "الفلق", englishNameTranslation: "The Daybreak", numberOfAyahs: 5, revelationType: "Meccan" },
                { number: 114, englishName: "An-Nas", name: "الناس", englishNameTranslation: "Mankind", numberOfAyahs: 6, revelationType: "Meccan" }
            ]
        };

        const MOCK_ALLAH_NAMES = [
            { arabic: "الرَّحْمَنُ", english: "Ar-Rahman", meaning: "The Beneficent" },
            { arabic: "الرَّحِيمُ", english: "Ar-Rahim", meaning: "The Merciful" },
            { arabic: "الْمَلِكُ", english: "Al-Malik", meaning: "The Eternal Lord" },
            { arabic: "الْقُدُّوسُ", english: "Al-Quddus", meaning: "The Most Sacred" },
            { arabic: "السَّلاَمُ", english: "As-Salam", meaning: "The Source of Peace" },
            { arabic: "الْمُؤْمِنُ", english: "Al-Mu'min", meaning: "The Inspirer of Faith" },
            { arabic: "الْمُهَيْمِنُ", english: "Al-Muhaymin", meaning: "The Guardian" },
            { arabic: "الْعَزِيزُ", english: "Al-Aziz", meaning: "The Almighty" },
            { arabic: "الْجَبَّارُ", english: "Al-Jabbar", meaning: "The Compeller" },
            { arabic: "الْمُتَكَبِّرُ", english: "Al-Mutakabbir", meaning: "The Supreme" }
        ];

        // --- Core Functions ---

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupNavigation();
            setupHadithCollectionSelector();
        });

        // Initialize all app features
        function initializeApp() {
            updateDateTime();
            setInterval(updateDateTime, 60000); // Update every minute
            
            getUserLocation();
            loadDailyVerse();
            loadSurahList();
            loadAllahNames();
            loadIslamicCalendar();
            loadHadithBooks();
            
            // Set up search functionality
            document.getElementById('quran-search').addEventListener('input', handleQuranSearch);
            
            // Initial Qibla display
            document.getElementById('qibla-arrow').style.transform = `translateX(-50%) rotate(${qiblaDirection}deg)`;

            // Initial Tasbih target
            dhikrTarget = parseInt(document.getElementById('dhikr-type').value);
        }

        // Setup bottom navigation
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    switchTab(this.getAttribute('data-tab'));
                });
            });
        }

        // Setup hadith collection selector
        function setupHadithCollectionSelector() {
            const collectionBtns = document.querySelectorAll('.collection-btn');
            
            collectionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    collectionBtns.forEach(b => b.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Update current collection
                    currentHadithCollection = this.getAttribute('data-collection');
                    
                    // Load books for the selected collection
                    loadHadithBooks();
                });
            });
        }

        // Switch to specific tab
        function switchTab(tabId) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        }

        // Display Toast Notification
        function showToast(message, type = 'info') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            let toast = document.createElement('div');
            toast.classList.add('toast');
            if (type === 'error') {
                toast.style.backgroundColor = '#dc3545';
            } else if (type === 'success') {
                toast.style.backgroundColor = '#28a745';
            }
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 3000);
        }

        // --- Date/Time/Location Functions ---

        // Update current date and time
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
            
            // Update Hijri date
            updateHijriDate(now);
        }
        
        // Update Hijri date
        function updateHijriDate(date) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            
            fetch(`${HIJRI_API}/${day}-${month}-${year}`)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    const hijri = data.data.hijri;
                    document.getElementById('hijri-date').textContent = 
                        `${hijri.day} ${hijri.month.en} ${hijri.year} AH`;
                })
                .catch(error => {
                    console.error('Error fetching Hijri date:', error);
                    document.getElementById('hijri-date').textContent = 'Hijri date unavailable';
                });
        }

        // Get user location for prayer times
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        userLocation = { lat: lat, lng: lon };
                        document.getElementById('location-display').textContent = 'Location detected';
                        fetchPrayerTimes(lat, lon);
                        calculateQiblaDirection(lat, lon);
                    },
                    error => {
                        console.error('Geolocation error:', error);
                        document.getElementById('location-display').textContent = 'Location access denied';
                        // Default to Makkah
                        userLocation = { lat: 21.4225, lng: 39.8262 };
                        fetchPrayerTimes(21.4225, 39.8262);
                        document.getElementById('qibla-degrees').textContent = '0';
                        showToast('Using default location (Makkah)', 'error');
                    }
                );
            } else {
                document.getElementById('location-display').textContent = 'Geolocation not supported';
                userLocation = { lat: 21.4225, lng: 39.8262 }; // Default to Makkah
                fetchPrayerTimes(21.4225, 39.8262);
            }
        }

        // --- Prayer Times & Qibla Functions ---

        // Fetch prayer times from API
        async function fetchPrayerTimes(lat, lon) {
            const date = new Date();
            const today = `${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}`;
            
            try {
                const response = await fetch(`${PRAYER_API}/timings/${today}?latitude=${lat}&longitude=${lon}&method=2`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                
                const timings = data.data.timings;
                prayerTimes = {
                    Fajr: timings.Fajr,
                    Sunrise: timings.Sunrise,
                    Dhuhr: timings.Dhuhr,
                    Asr: timings.Asr,
                    Maghrib: timings.Maghrib,
                    Isha: timings.Isha
                };
                
                updatePrayerTimesDisplay();
                calculateNextPrayer();
            } catch (error) {
                console.error('Error fetching prayer times:', error);
                // Fallback to sample prayer times
                prayerTimes = {
                    Fajr: "05:30",
                    Sunrise: "06:45",
                    Dhuhr: "12:30",
                    Asr: "15:45",
                    Maghrib: "18:20",
                    Isha: "19:45"
                };
                updatePrayerTimesDisplay();
                calculateNextPrayer();
                showToast('Using sample prayer times', 'error');
            }
        }
        
        // Update prayer times display
        function updatePrayerTimesDisplay() {
            document.getElementById('fajr-time').textContent = prayerTimes.Fajr;
            document.getElementById('dhuhr-time').textContent = prayerTimes.Dhuhr;
            document.getElementById('asr-time').textContent = prayerTimes.Asr;
            document.getElementById('maghrib-time').textContent = prayerTimes.Maghrib;
            document.getElementById('isha-time').textContent = prayerTimes.Isha;
            
            // Update detailed prayer times in prayer tab
            document.getElementById('prayer-fajr').textContent = prayerTimes.Fajr;
            document.getElementById('prayer-sunrise').textContent = prayerTimes.Sunrise;
            document.getElementById('prayer-dhuhr').textContent = prayerTimes.Dhuhr;
            document.getElementById('prayer-asr').textContent = prayerTimes.Asr;
            document.getElementById('prayer-maghrib').textContent = prayerTimes.Maghrib;
            document.getElementById('prayer-isha').textContent = prayerTimes.Isha;
        }
        
        // Calculate next prayer and countdown
        function calculateNextPrayer() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const prayers = [
                { name: 'Fajr', time: prayerTimes.Fajr },
                { name: 'Dhuhr', time: prayerTimes.Dhuhr },
                { name: 'Asr', time: prayerTimes.Asr },
                { name: 'Maghrib', time: prayerTimes.Maghrib },
                { name: 'Isha', time: prayerTimes.Isha }
            ];
            
            // Reset active prayer cards
            document.querySelectorAll('.prayer-time-card').forEach(card => {
                card.classList.remove('active');
            });
            
            let nextPrayer = null;
            let nextPrayerTime = null;
            
            for (const prayer of prayers) {
                const [hours, minutes] = prayer.time.split(':').map(Number);
                const prayerTime = hours * 60 + minutes;
                
                if (prayerTime > currentTime) {
                    nextPrayer = prayer;
                    nextPrayerTime = prayerTime;
                    break;
                }
            }
            
            // If no prayer found for today, use Fajr tomorrow
            if (!nextPrayer) {
                nextPrayer = { name: 'Fajr', time: prayerTimes.Fajr };
                nextPrayerTime = 24 * 60 + (parseInt(prayerTimes.Fajr.split(':')[0]) * 60 + parseInt(prayerTimes.Fajr.split(':')[1]));
            }
            
            // Update next prayer banner
            document.getElementById('next-prayer-name').textContent = nextPrayer.name;
            
            // Calculate time until next prayer
            const timeUntilPrayer = nextPrayerTime - currentTime;
            const hours = Math.floor(timeUntilPrayer / 60);
            const minutes = timeUntilPrayer % 60;
            
            document.getElementById('next-prayer-time').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            
            // Highlight current prayer card
            document.getElementById(`${nextPrayer.name.toLowerCase()}-card`).classList.add('active');
            
            // Update countdown every minute
            clearInterval(nextPrayerTimer);
            nextPrayerTimer = setInterval(calculateNextPrayer, 60000);
        }
        
        // Calculate Qibla direction
        function calculateQiblaDirection(lat, lon) {
            const KAABA_LAT = 21.4225;
            const KAABA_LON = 39.8262;
            
            const latRad = lat * Math.PI / 180;
            const lonRad = lon * Math.PI / 180;
            const kaabaLatRad = KAABA_LAT * Math.PI / 180;
            const kaabaLonRad = KAABA_LON * Math.PI / 180;
            
            const y = Math.sin(kaabaLonRad - lonRad);
            const x = Math.cos(latRad) * Math.tan(kaabaLatRad) - Math.sin(latRad) * Math.cos(kaabaLonRad - lonRad);
            
            let qiblaBearing = Math.atan2(y, x) * 180 / Math.PI;
            if (qiblaBearing < 0) qiblaBearing += 360;
            
            qiblaDirection = qiblaBearing;
            document.getElementById('qibla-degrees').textContent = Math.round(qiblaBearing);
            document.getElementById('qibla-arrow').style.transform = `translateX(-50%) rotate(${qiblaBearing}deg)`;
        }

        // Recalibrate Qibla
        function recalibrateQibla() {
            if (userLocation) {
                calculateQiblaDirection(userLocation.lat, userLocation.lng);
                showToast('Qibla direction recalibrated', 'success');
            } else {
                showToast('Unable to recalibrate. Location not available.', 'error');
            }
        }

        // --- Quran Functions ---

        // Load daily Quran verse
        function loadDailyVerse() {
            // For demo, we'll use a random verse
            const randomSurah = Math.floor(Math.random() * 114) + 1;
            const randomAyah = Math.floor(Math.random() * 10) + 1;
            
            fetch(`${QURAN_API}/ayah/${randomSurah}:${randomAyah}/editions/quran-uthmani,en.sahih`)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    const verse = data.data[0];
                    const translation = data.data[1];
                    
                    document.getElementById('daily-verse-arabic').textContent = verse.text;
                    document.getElementById('daily-verse-translation').textContent = translation.text;
                    document.getElementById('daily-verse-reference').textContent = 
                        `Surah ${verse.surah.englishName}, Ayah ${verse.numberInSurah}`;
                })
                .catch(error => {
                    console.error('Error loading daily verse:', error);
                    document.getElementById('daily-verse-arabic').textContent = 'بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ';
                    document.getElementById('daily-verse-translation').textContent = 'In the name of Allah, the Entirely Merciful, the Especially Merciful.';
                    document.getElementById('daily-verse-reference').textContent = 'Surah Al-Fatihah, Ayah 1';
                });
        }

        // Load surah list
        function loadSurahList() {
            try {
                // Try to fetch from API first
                fetch(`${QURAN_API}/surah`)
                    .then(response => {
                        if (!response.ok) throw new Error('Failed to fetch surah list');
                        return response.json();
                    })
                    .then(data => {
                        allSurahs = data.data;
                        renderSurahList(allSurahs);
                    })
                    .catch(error => {
                        console.error('Error loading surah list from API:', error);
                        // Fallback to mock data
                        allSurahs = MOCK_QURAN_DATA.surahs;
                        renderSurahList(allSurahs);
                        showToast('Using limited surah data', 'error');
                    });
            } catch (error) {
                console.error('Error in loadSurahList:', error);
                allSurahs = MOCK_QURAN_DATA.surahs;
                renderSurahList(allSurahs);
            }
        }

        function renderSurahList(surahs) {
            const listContainer = document.getElementById('surah-list');
            let html = '';
            
            surahs.forEach(surah => {
                html += `
                    <div class="surah-item" onclick="loadFullSurah(${surah.number})">
                        <div>
                            <div class="surah-name">${surah.englishName}</div>
                            <div class="surah-details">${surah.englishNameTranslation} • ${surah.numberOfAyahs} verses • ${surah.revelationType}</div>
                        </div>
                        <div class="arabic-text">${surah.name}</div>
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
        }

        // Load a specific surah
        function loadSurah(surahNumber) {
            currentSurah = surahNumber;
            currentVerse = 1;
            loadVerse(surahNumber, 1);
            switchTab('quran-tab');
        }

        // Load full surah in modal
        async function loadFullSurah(surahNumber) {
            try {
                // Show loading state
                document.getElementById('surah-modal-header').innerHTML = `
                    <div class="text-center">
                        <div class="spinner-border" role="status"></div>
                        <p class="mt-2">Loading Surah...</p>
                    </div>
                `;
                document.getElementById('surah-modal-content').innerHTML = '';

                // Fetch surah data
                const response = await fetch(`${QURAN_API}/surah/${surahNumber}/editions/quran-uthmani,en.sahih`);
                if (!response.ok) throw new Error('Failed to fetch surah data');
                
                const data = await response.json();
                const surah = data.data[0];
                const translation = data.data[1];
                
                // Update modal header
                document.getElementById('surah-modal-header').innerHTML = `
                    <h3>${surah.englishName} (${surah.name})</h3>
                    <p>${surah.englishNameTranslation} • ${surah.numberOfAyahs} verses • ${surah.revelationType}</p>
                `;
                
                // Update modal content with all verses
                let versesHtml = '';
                for (let i = 0; i < surah.ayahs.length; i++) {
                    versesHtml += `
                        <div class="verse-item">
                            <div class="arabic-text">
                                <span class="verse-number">${surah.ayahs[i].numberInSurah}</span>
                                ${surah.ayahs[i].text}
                            </div>
                            <div class="translation-text">
                                ${translation.ayahs[i].text}
                            </div>
                        </div>
                    `;
                }
                
                document.getElementById('surah-modal-content').innerHTML = versesHtml;
                
                // Show the modal
                const surahModal = new bootstrap.Modal(document.getElementById('surahModal'));
                surahModal.show();
                
            } catch (error) {
                console.error('Error loading full surah:', error);
                showToast('Error loading surah. Please try again.', 'error');
            }
        }

        // Load a specific verse
        function loadVerse(surah, verse) {
            fetch(`${QURAN_API}/ayah/${surah}:${verse}/editions/quran-uthmani,en.sahih`)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    const verseData = data.data[0];
                    const translation = data.data[1];
                    
                    document.getElementById('quran-display-arabic').textContent = verseData.text;
                    document.getElementById('quran-display-translation').textContent = translation.text;
                    document.getElementById('quran-display-reference').textContent = 
                        `Surah ${verseData.surah.englishName}, Ayah ${verseData.numberInSurah}`;
                })
                .catch(error => {
                    console.error('Error loading verse:', error);
                    showToast('Error loading verse. Please try again.', 'error');
                });
        }

        // Navigate to previous verse
        function previousVerse() {
            if (currentVerse > 1) {
                currentVerse--;
                loadVerse(currentSurah, currentVerse);
            } else {
                showToast('This is the first verse of the surah');
            }
        }

        // Navigate to next verse
        function nextVerse() {
            // For demo, we'll just increment (in a real app, you'd check if this is the last verse)
            currentVerse++;
            loadVerse(currentSurah, currentVerse);
        }

        // Load random verse
        function randomVerse() {
            const randomSurah = Math.floor(Math.random() * 114) + 1;
            const randomAyah = Math.floor(Math.random() * 10) + 1;
            currentSurah = randomSurah;
            currentVerse = randomAyah;
            loadVerse(randomSurah, randomAyah);
        }

        // Handle Quran search
        function handleQuranSearch(e) {
            const query = e.target.value.toLowerCase();
            if (query.length < 3) return;
            
            // In a real app, you would call a search API
            // For demo, we'll just show a message
            showToast(`Searching for: ${query}`);
        }

        // --- Tasbih Counter Functions ---

        function incrementDhikr() {
            dhikrCount++;
            document.getElementById('dhikr-counter').textContent = dhikrCount;
            
            // Check if target reached
            if (dhikrCount >= dhikrTarget) {
                document.getElementById('dhikr-counter').style.color = '#ff6a00';
                showToast('Dhikr target reached! Allahu Akbar!', 'success');
                // Vibrate on mobile if supported
                if (navigator.vibrate) {
                    navigator.vibrate(200);
                }
            }
        }

        function resetDhikr() {
            dhikrCount = 0;
            document.getElementById('dhikr-counter').textContent = dhikrCount;
            document.getElementById('dhikr-counter').style.color = '';
            
            // Update target based on selection
            const select = document.getElementById('dhikr-type');
            dhikrTarget = parseInt(select.value);
        }

        // --- 99 Names of Allah Functions ---

        function loadAllahNames() {
            // Using mock data for simplicity
            displayAllahName(0);
        }

        function displayAllahName(index) {
            const name = MOCK_ALLAH_NAMES[index];
            document.getElementById('allah-name-arabic').textContent = name.arabic;
            document.getElementById('allah-name-english').textContent = name.english;
            document.getElementById('allah-name-meaning').textContent = name.meaning;
        }

        function nextAllahName() {
            allahNamesIndex = (allahNamesIndex + 1) % MOCK_ALLAH_NAMES.length;
            displayAllahName(allahNamesIndex);
        }

        // --- Islamic Calendar Functions ---

        function loadIslamicCalendar() {
            const calendarElement = document.getElementById('islamic-calendar');
            
            // Generate a simple calendar for demo
            let html = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                html += `<div class="calendar-header">${day}</div>`;
            });
            
            // Add days
            for (let i = 1; i <= 30; i++) {
                const isToday = i === new Date().getDate();
                const isHijri = i % 5 === 0; // Just for demo
                
                let dayClass = 'calendar-day';
                if (isToday) dayClass += ' active';
                if (isHijri) dayClass += ' hijri';
                
                html += `<div class="${dayClass}">${i}</div>`;
            }
            
            calendarElement.innerHTML = html;
            
            // Update month display
            const months = ['Muharram', 'Safar', 'Rabi al-Awwal', 'Rabi al-Thani', 
                           'Jumada al-Awwal', 'Jumada al-Thani', 'Rajab', 'Sha\'ban', 
                           'Ramadan', 'Shawwal', 'Dhu al-Qi\'dah', 'Dhu al-Hijjah'];
            const currentMonth = months[new Date().getMonth()];
            document.getElementById('hijri-month').textContent = `${currentMonth} 1445 AH`;
        }

        // --- Hadith Functions ---

        // Load hadith books for the selected collection
        async function loadHadithBooks() {
            try {
                const response = await fetch(`${HADITH_API}/collection/${currentHadithCollection}/books`, {
                    headers: {
                        'x-rapidapi-host': 'hadith2.p.rapidapi.com',
                        'x-rapidapi-key': RAPIDAPI_KEY
                    }
                });
                
                if (!response.ok) throw new Error('Failed to fetch hadith books');
                const data = await response.json();
                
                // Display books
                displayHadithBooks(data.data);
                
            } catch (error) {
                console.error('Error fetching hadith books:', error);
                document.getElementById('hadith-books-list').innerHTML = `
                    <div class="text-center">
                        <p>Unable to load hadith books at the moment. Please try again later.</p>
                        <button class="btn btn-primary" onclick="loadHadithBooks()">Retry</button>
                    </div>
                `;
            }
        }

        // Display hadith books
        function displayHadithBooks(books) {
            let html = `<h6 class="mb-3">Books in ${currentHadithCollection}</h6>`;
            
            if (books && books.length > 0) {
                books.forEach(book => {
                    html += `
                        <div class="hadith-book-item" onclick="loadHadithsByBook(${book.id})">
                            <div class="hadith-book-name">${book.name}</div>
                            <div class="hadith-book-details">${book.hadiths} hadiths</div>
                        </div>
                    `;
                });
            } else {
                html += '<p class="text-center">No books found for this collection.</p>';
            }
            
            document.getElementById('hadith-books-list').innerHTML = html;
            document.getElementById('hadith-results').innerHTML = '';
        }

        // Load hadiths by book
        async function loadHadithsByBook(bookId) {
            try {
                // Load first few hadiths from the book
                const response = await fetch(`${HADITH_API}/${currentHadithCollection}/${bookId}/1`, {
                    headers: {
                        'x-rapidapi-host': 'hadith2.p.rapidapi.com',
                        'x-rapidapi-key': RAPIDAPI_KEY
                    }
                });
                
                if (!response.ok) throw new Error('Failed to fetch hadiths');
                const data = await response.json();
                
                displayHadithResults(data.data);
                
            } catch (error) {
                console.error('Error fetching hadiths:', error);
                showToast('Error loading hadiths. Please try again.', 'error');
            }
        }

        // Display hadith results
        function displayHadithResults(hadiths) {
            let html = `<h6 class="mb-3">Hadiths from ${currentHadithCollection}</h6>`;
            
            if (hadiths && hadiths.length > 0) {
                hadiths.forEach(hadith => {
                    html += `
                        <div class="hadith-item">
                            <div class="hadith-arabic">${hadith.arabic || 'Arabic text not available'}</div>
                            <p>${hadith.english}</p>
                            <div class="hadith-reference">
                                ${currentHadithCollection}, Book: ${hadith.bookNumber}, Hadith: ${hadith.id}
                            </div>
                        </div>
                    `;
                });
            } else {
                html += '<p class="text-center">No hadiths found.</p>';
            }
            
            document.getElementById('hadith-results').innerHTML = html;
        }

        // Search hadiths
        async function searchHadiths() {
            const query = document.getElementById('hadith-search').value.trim();
            if (query.length < 3) {
                showToast('Please enter at least 3 characters to search.');
                return;
            }
            
            // Since the hadith2 API doesn't have direct search, we'll use a fallback approach
            showToast(`Searching hadiths for: ${query}. This may take a moment.`);
            
            try {
                // For now, we'll use the local knowledge base for search
                const filteredHadiths = ISLAMIC_KNOWLEDGE.hadiths.filter(hadith => 
                    hadith.text.toLowerCase().includes(query.toLowerCase()) ||
                    hadith.reference.toLowerCase().includes(query.toLowerCase())
                );
                
                let html = `<h6 class="mb-3">Search Results for "${query}"</h6>`;
                
                if (filteredHadiths.length > 0) {
                    filteredHadiths.forEach(hadith => {
                        html += `
                            <div class="hadith-item">
                                <p>${hadith.text}</p>
                                <div class="hadith-reference">
                                    ${hadith.reference}
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<p class="text-center">No hadiths found matching your search.</p>';
                }
                
                document.getElementById('hadith-results').innerHTML = html;
                
            } catch (error) {
                console.error('Error searching hadiths:', error);
                showToast('Error searching hadiths. Please try again.', 'error');
            }
        }

        // --- Enhanced Islamic Chatbot Functions ---

        function handleChatInput(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        }

        function askQuickQuestion(question) {
            document.getElementById('chat-input').value = question;
            sendChatMessage();
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            const chatMessages = document.getElementById('chat-messages');

            if (!message) return;

            // Add user message to chat
            addChatMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            const typingIndicator = addChatMessage('Typing<span class="loading-dots"></span>', 'bot');

            try {
                // Try to get response from AI chatbot
                const response = await getAIResponse(message);
                
                // Remove typing indicator
                typingIndicator.remove();

                if (response && response.answer) {
                    addChatMessage(response.answer, 'bot');
                } else {
                    // Fallback to local knowledge base
                    const fallbackResponse = generateIslamicResponse(message);
                    addChatMessage(fallbackResponse, 'bot');
                }
            } catch (error) {
                console.error('Chatbot error:', error);
                // Remove typing indicator
                typingIndicator.remove();
                
                // Fallback to local knowledge base
                const fallbackResponse = generateIslamicResponse(message);
                addChatMessage(fallbackResponse, 'bot');
            }

            // Scroll to bottom
            scrollChatToBottom();
        }

        // Get AI response from API
        async function getAIResponse(message, category = "general", language = "en") {
            try {
                const response = await fetch(`${CHATBOT_API}/chat?noqueue=1`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-rapidapi-host': 'ai-islamic-chatbot-quran-hadith-fiqh-fatwa-halal-q-a.p.rapidapi.com',
                        'x-rapidapi-key': RAPIDAPI_KEY
                    },
                    body: JSON.stringify({
                        message: message,
                        category: category,
                        language: language
                    })
                });
                
                if (!response.ok) throw new Error('API response not ok');
                return await response.json();
            } catch (error) {
                console.error('AI Chatbot API error:', error);
                return null;
            }
        }

        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            
            // Format message with line breaks
            const formattedMessage = message.replace(/\n/g, '<br>');
            messageDiv.innerHTML = `<p>${formattedMessage}</p>`;
            
            chatMessages.appendChild(messageDiv);

            // Scroll to bottom
            scrollChatToBottom();

            return messageDiv;
        }

        function scrollChatToBottom() {
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateIslamicResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Greetings
            if (lowerMessage.includes('salam') || lowerMessage.includes('hello') || lowerMessage.includes('hi') || 
                lowerMessage.includes('assalam') || lowerMessage.includes('peace')) {
                const randomGreeting = ISLAMIC_KNOWLEDGE.greetings[
                    Math.floor(Math.random() * ISLAMIC_KNOWLEDGE.greetings.length)
                ];
                return randomGreeting;
            }
            
            // Five Pillars of Islam
            if (lowerMessage.includes('pillar') || lowerMessage.includes('five pillar')) {
                return ISLAMIC_KNOWLEDGE.pillars.answer;
            }
            
            // Wudu (Ablution)
            if (lowerMessage.includes('wudu') || lowerMessage.includes('ablution') || 
                lowerMessage.includes('purification') || lowerMessage.includes('clean')) {
                return ISLAMIC_KNOWLEDGE.wudu.answer;
            }
            
            // Ramadan
            if (lowerMessage.includes('ramadan') || lowerMessage.includes('fasting') || 
                lowerMessage.includes('sawm') || lowerMessage.includes('roza')) {
                return ISLAMIC_KNOWLEDGE.ramadan.answer;
            }
            
            // Zakat
            if (lowerMessage.includes('zakat') || lowerMessage.includes('charity') || 
                lowerMessage.includes('sadaqah') || lowerMessage.includes('poor due')) {
                return ISLAMIC_KNOWLEDGE.zakat.answer;
            }
            
            // Prayer/Salah
            if (lowerMessage.includes('prayer') || lowerMessage.includes('salah') || 
                lowerMessage.includes('namaz') || lowerMessage.includes('salat')) {
                if (lowerMessage.includes('time') || lowerMessage.includes('when')) {
                    return "Prayer times are based on the position of the sun. Fajr begins at dawn, Dhuhr when the sun passes its zenith, Asr in the afternoon, Maghrib at sunset, and Isha when twilight has disappeared. Check the Prayer tab for your local times!";
                }
                if (lowerMessage.includes('how many')) {
                    return "There are 5 obligatory prayers in Islam: Fajr (dawn), Dhuhr (noon), Asr (afternoon), Maghrib (sunset), and Isha (night).";
                }
                return "Salah (prayer) is the second pillar of Islam. It is a direct connection between the worshipper and Allah, performed five times a day at specific times.";
            }
            
            // Quran
            if (lowerMessage.includes('quran') || lowerMessage.includes('koran') || 
                lowerMessage.includes('recitation') || lowerMessage.includes('verse')) {
                if (lowerMessage.includes('first')) {
                    return "The first Surah in the Quran is Al-Fatihah (The Opening). It consists of 7 verses and is recited in every unit of Muslim prayer.";
                }
                if (lowerMessage.includes('last')) {
                    return "The last Surah in the Quran is An-Nas (Mankind). It is the 114th chapter and contains 6 verses seeking refuge with Allah from the evil of whisperers.";
                }
                if (lowerMessage.includes('longest')) {
                    return "The longest Surah in the Quran is Al-Baqarah (The Cow) with 286 verses. It covers various aspects of Islamic law, faith, and practice.";
                }
                if (lowerMessage.includes('shortest')) {
                    return "The shortest Surah in the Quran is Al-Kawthar (Abundance) with only 3 verses. It was revealed to comfort Prophet Muhammad (PBUH).";
                }
                const randomFact = ISLAMIC_KNOWLEDGE.quranFacts[
                    Math.floor(Math.random() * ISLAMIC_KNOWLEDGE.quranFacts.length)
                ];
                return `The Quran is the holy book of Islam, revealed to Prophet Muhammad (PBUH). ${randomFact} You can read the Quran in the Quran tab.`;
            }
            
            // Hadith
            if (lowerMessage.includes('hadith') || lowerMessage.includes('sunnah') || 
                lowerMessage.includes('prophet say') || lowerMessage.includes('muhammad said')) {
                if (lowerMessage.includes('kindness') || lowerMessage.includes('mercy') || 
                    lowerMessage.includes('compassion') || lowerMessage.includes('good')) {
                    const kindnessHadith = ISLAMIC_KNOWLEDGE.hadiths.find(h => 
                        h.text.toLowerCase().includes('kindness') || h.text.toLowerCase().includes('manners') ||
                        h.text.toLowerCase().includes('brother') || h.text.toLowerCase().includes('anger')
                    );
                    return `${kindnessHadith.text}\n\n<small class="hadith-reference">Reference: ${kindnessHadith.reference}</small>`;
                }
                const randomHadith = ISLAMIC_KNOWLEDGE.hadiths[
                    Math.floor(Math.random() * ISLAMIC_KNOWLEDGE.hadiths.length)
                ];
                return `${randomHadith.text}\n\n<small class="hadith-reference">Reference: ${randomHadith.reference}</small>`;
            }
            
            // Prophet Muhammad (PBUH)
            if (lowerMessage.includes('prophet') || lowerMessage.includes('muhammad') || 
                lowerMessage.includes('messenger') || lowerMessage.includes('rasul')) {
                if (lowerMessage.includes('birth') || lowerMessage.includes('born')) {
                    return "Prophet Muhammad (PBUH) was born in Mecca in the Year of the Elephant, which corresponds to approximately 570 CE.";
                }
                if (lowerMessage.includes('death') || lowerMessage.includes('die') || lowerMessage.includes('passed')) {
                    return "Prophet Muhammad (PBUH) passed away in Medina in 632 CE at the age of 63, after completing his mission of conveying Allah's message.";
                }
                return "Prophet Muhammad (PBUH) is the final messenger of Allah, sent as a mercy to all creation. He received revelation over 23 years, which was compiled as the Quran.";
            }
            
            // Allah/God
            if (lowerMessage.includes('allah') || lowerMessage.includes('god') || 
                lowerMessage.includes('creator') || lowerMessage.includes('lord')) {
                return "Allah is the Arabic word for God. Muslims believe in one, unique, incomparable God who has no son nor partner, and that none has the right to be worshipped but Him. You can learn about the 99 Names of Allah in the Tasbih tab.";
            }
            
            // Islam/Muslim
            if (lowerMessage.includes('islam') || lowerMessage.includes('muslim') || 
                lowerMessage.includes('religion') || lowerMessage.includes('faith')) {
                if (lowerMessage.includes('meaning')) {
                    return "The word 'Islam' means 'submission' to the will of Allah. A 'Muslim' is one who submits to Allah's will.";
                }
                return "Islam is a monotheistic Abrahamic religion that teaches there is only one God (Allah) and that Muhammad is His final messenger. The primary sources of Islamic teachings are the Quran and the Hadith.";
            }
            
            // Hajj
            if (lowerMessage.includes('hajj') || lowerMessage.includes('pilgrimage') || 
                lowerMessage.includes('mecca') || lowerMessage.includes('kaaba')) {
                return "Hajj is the fifth pillar of Islam. It is the pilgrimage to the holy city of Mecca in Saudi Arabia that every Muslim must make at least once in their lifetime if they are able.";
            }
            
            // Qibla
            if (lowerMessage.includes('qibla') || lowerMessage.includes('direction') || 
                lowerMessage.includes('kaaba') || lowerMessage.includes('mecca')) {
                return `The Qibla is the direction Muslims face during prayer, towards the Kaaba in Mecca. Your current Qibla direction is approximately ${Math.round(qiblaDirection)} degrees. You can find the exact direction in the Prayer tab.`;
            }
            
            // Default response for unrecognized queries
            return "I'm sorry, I don't have a specific answer for that question. Could you please rephrase or ask about:\n\n• Quran and its teachings\n• Prayer (Salah) and purification\n• Fasting in Ramadan\n• Zakat and charity\n• Hajj pilgrimage\n• Prophet Muhammad (PBUH)\n• Islamic beliefs and practices\n• Hadith and Sunnah";
        }
    </script>
</body>
</html>
